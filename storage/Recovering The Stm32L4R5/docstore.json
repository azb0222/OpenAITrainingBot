{"docstore/metadata": {"5c0d45f7-bdd3-4170-9492-a0e07f86727f": {"doc_hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "0d008e71-9ca3-4ea2-8b59-5a6222890f11": {"doc_hash": "dad8411a7f59edbd65b3af4df13cb47b41820cc3a0757ef62ea837a102938a71", "ref_doc_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f"}, "8eeed912-172d-4132-8e7a-971e59de1098": {"doc_hash": "e6dbe68f34096f559c3800a3e9baca0001b691dba99650dbda30ec126c018706", "ref_doc_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f"}, "91f43553-307d-4d09-84e5-496f5585c945": {"doc_hash": "d6f454513d835d5c2724e5b52ac0ab0f4ae2363c630f87d0dd5a54fcf9c206d9", "ref_doc_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f"}, "769c9c43-94ff-4edd-89df-d532324b8765": {"doc_hash": "bc7d2f2272f8e12c627a23560180991d0393800aa909eec27e61075a54e5c5e9", "ref_doc_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f"}, "efaf7618-6d4e-4e59-b51f-09cdc8e31e29": {"doc_hash": "b24be52ba573377597b86f6b2d7720781d86c066e8425825d4a223259abe48bc", "ref_doc_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f"}}, "docstore/data": {"0d008e71-9ca3-4ea2-8b59-5a6222890f11": {"__data__": {"id_": "0d008e71-9ca3-4ea2-8b59-5a6222890f11", "embedding": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "3": {"node_id": "8eeed912-172d-4132-8e7a-971e59de1098", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "e6dbe68f34096f559c3800a3e9baca0001b691dba99650dbda30ec126c018706"}}, "hash": "dad8411a7f59edbd65b3af4df13cb47b41820cc3a0757ef62ea837a102938a71", "text": "Recovering the STM32L4R5\n\nWe discovered an SWD configuration error was present in older versions of the ST Board Support Package (BSP) for the Arduino IDE. The configuration error would occasionally cause corruption of the Option Bytes in the FLASH registers. Below we outline the steps required to repair the Option Bytes of the Swan.\n\nNote\n\nThe configuration error was resolved in the Arduino BSP, STM32 MCU based boards, version 2.3.0.\n\nHardware Setup\nConnect the STLink Debugger to the Swan with the included ribbon cable and your computer via USB\nApply power to the Swan via the micro USB port and plug into your computer (or other USB power source)\nUpdate with STM32CubeProgrammer (GUI)\n\nInvalid FLASH Registers\n\nRegister\tValue\nOPTR\t0x08000000\nPCROP1SR\t0xFFFE0000\nPCROP1ER\t0xFFFE0000\nWRP1AR\t0xFF00FF00\nWRP2AR\t0xFF00FF00\nPCROP2SR\t0xFFFFFFFF\nPCROP2ER\t0xFFFF0000\nWRP1BR\t0xFF00FFFF\nWRP2BR\t0xFF00FFFF\n\nWhen the Option Byte registers get into this state, the STM32L4R5 will no longer execute firmware or allow programming.\n\nFortunately, the STM32L4R5 can be recovered using the STM32CubeProgrammer, by updating the following FLASH registers (in the [REG] tab) to the following values:\n\nValid FLASH", "start_char_idx": 0, "end_char_idx": 1197, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n"}, "__type__": "1"}, "8eeed912-172d-4132-8e7a-971e59de1098": {"__data__": {"id_": "8eeed912-172d-4132-8e7a-971e59de1098", "embedding": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "2": {"node_id": "0d008e71-9ca3-4ea2-8b59-5a6222890f11", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "dad8411a7f59edbd65b3af4df13cb47b41820cc3a0757ef62ea837a102938a71"}, "3": {"node_id": "91f43553-307d-4d09-84e5-496f5585c945", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "d6f454513d835d5c2724e5b52ac0ab0f4ae2363c630f87d0dd5a54fcf9c206d9"}}, "hash": "e6dbe68f34096f559c3800a3e9baca0001b691dba99650dbda30ec126c018706", "text": "(in the [REG] tab) to the following values:\n\nValid FLASH Registers\n\nRegister\tValue\nOPTR\t0xFFEF98AA\nPCROP1SR\t0xFFFFFFFF\nPCROP1ER\t0xFFFF0000\nWRP1AR\t0xFF00FFFF\nWRP2AR\t0xFF00FFFF\nPCROP2SR\t0xFFFFFFFF\nPCROP2ER\t0xFFFF0000\nWRP1BR\t0xFF00FFFF\nWRP2BR\t0xFF00FFFF\n\nAfter updating the option bytes, the STM32L4R5 can now be programmed using the STM32CubeProgrammer and execute firmware. Once you have updated the ST BSP, the device can be debugged and programmed normally via SWD again.\n\nUpdate with STM32_Programmer_CLI\n\nApply the following commands in order:\n\nCOPY\nSTM32_Programmer_CLI --connect port=SWD --optionbytes RDP=0xBB\nSTM32_Programmer_CLI --connect port=SWD --optionbytes RDP=0xAA\nSTM32_Programmer_CLI --connect port=SWD --optionbytes nRST_STOP=1 IWDG_SW=1 IWDG_STOP=1 IWDG_STDBY=1 WWDG_SW=1 DBANK=1 nBOOT1=1 SRAM2_PE=1 SRAM2_RST=1 nSWBOOT0=01 PCROP1_STRT=0x1FFFF PCROP1_END=0x10000 WRP1A_STRT=0xFF WRP1A_END=0 WRP1B_STRT=0xFF WRP1B_END=0\nSTM32_Programmer_CLI --connect port=SWD --optionbytes PCROP_RDP=1\n\nVerify the option byte values by displaying them to the command", "start_char_idx": 1150, "end_char_idx": 2217, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n"}, "__type__": "1"}, "91f43553-307d-4d09-84e5-496f5585c945": {"__data__": {"id_": "91f43553-307d-4d09-84e5-496f5585c945", "embedding": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "2": {"node_id": "8eeed912-172d-4132-8e7a-971e59de1098", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "e6dbe68f34096f559c3800a3e9baca0001b691dba99650dbda30ec126c018706"}, "3": {"node_id": "769c9c43-94ff-4edd-89df-d532324b8765", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "bc7d2f2272f8e12c627a23560180991d0393800aa909eec27e61075a54e5c5e9"}}, "hash": "d6f454513d835d5c2724e5b52ac0ab0f4ae2363c630f87d0dd5a54fcf9c206d9", "text": "the option byte values by displaying them to the command prompt\n\nCOPY\nSTM32_Programmer_CLI --connect port=SWD --optionbytes displ\n\nCompare the response to the following...\n\nCOPY\nUPLOADING OPTION BYTES DATA ...\n\n  Bank          : 0x00\n  Address       : 0x40022020\n  Size          : 20 Bytes\n\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100%\n\n  Bank          : 0x01\n  Address       : 0x40022044\n  Size          : 16 Bytes\n\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100%\n\n\nOPTION BYTES BANK: 0\n\n   Read Out Protection:\n\n     RDP          : 0xAA (Level 0, no protection)\n\n   BOR Level:\n\n     BOR_LEV      : 0x0 (BOR Level 0, reset level threshold is around 1.7 V)\n\n   User Configuration:\n\n     nRST_STOP    : 0x1 (No reset generated when entering Stop mode)\n     nRST_STDBY   : 0x0 (Reset generated when entering Standby mode)\n     nRST_SHDW    : 0x0 (Reset generated when entering the Shutdown mode)\n     IWDG_SW      : 0x1 (Software independant watchdog)\n     IWDG_STOP    : 0x1 (IWDG counter active in stop mode)\n     IWDG_STDBY   : 0x1 (IWDG counter active in standby mode)\n     WWDG_SW      : 0x1", "start_char_idx": 2219, "end_char_idx": 3332, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n"}, "__type__": "1"}, "769c9c43-94ff-4edd-89df-d532324b8765": {"__data__": {"id_": "769c9c43-94ff-4edd-89df-d532324b8765", "embedding": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "2": {"node_id": "91f43553-307d-4d09-84e5-496f5585c945", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "d6f454513d835d5c2724e5b52ac0ab0f4ae2363c630f87d0dd5a54fcf9c206d9"}, "3": {"node_id": "efaf7618-6d4e-4e59-b51f-09cdc8e31e29", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "b24be52ba573377597b86f6b2d7720781d86c066e8425825d4a223259abe48bc"}}, "hash": "bc7d2f2272f8e12c627a23560180991d0393800aa909eec27e61075a54e5c5e9", "text": "    WWDG_SW      : 0x1 (Software window watchdog)\n     BFB2         : 0x0 (Dual-bank boot disable)\n     DBANK        : 0x1 (Dual bank mode with 64 bits data)\n     nBOOT1       : 0x1 (Boot from system memory when BOOT0=1)\n     SRAM2_PE     : 0x1 (SRAM2 parity check disable)\n     SRAM2_RST    : 0x1 (SRAM2 is not erased when a system reset occurs)\n     nSWBOOT0     : 0x1 (BOOT0 taken from PH3/BOOT0 pin)\n     nBOOT0       : 0x1 (BOOT0 = 0, boot from system memory when nSWBOOT0=1 and main flash is empty,otherwise, boot from main flash memory)\n\n   PCROP Protection (Bank 1):\n\n     PCROP1_STRT  : 0x1FFFF  (0x80FFFF8)\n     PCROP1_END   : 0x10000  (0x8080000)\n     PCROP_RDP    : 0x1 (PCROP zone is erased when RDP is decreased)\n\n   Write Protection (Bank 1):\n\n     WRP1A_STRT   : 0xFF  (0x80FF000)\n     WRP1A_END    : 0x0  (0x8000000)\n     WRP1B_STRT   : 0xFF  (0x80FF000)\n     WRP1B_END    : 0x0 ", "start_char_idx": 3369, "end_char_idx": 4265, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n"}, "__type__": "1"}, "efaf7618-6d4e-4e59-b51f-09cdc8e31e29": {"__data__": {"id_": "efaf7618-6d4e-4e59-b51f-09cdc8e31e29", "embedding": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "5c0d45f7-bdd3-4170-9492-a0e07f86727f", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "63f86eedd8f5797e25f1de595930bb63387b92f4d84f29c1614c7d627686d65b"}, "2": {"node_id": "769c9c43-94ff-4edd-89df-d532324b8765", "node_type": null, "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}, "hash": "bc7d2f2272f8e12c627a23560180991d0393800aa909eec27e61075a54e5c5e9"}}, "hash": "b24be52ba573377597b86f6b2d7720781d86c066e8425825d4a223259abe48bc", "text": "    WRP1B_END    : 0x0  (0x8000000)\n\nOPTION BYTES BANK: 1\n\n   PCROP Protection  (Bank 2):\n\n     PCROP2_STRT  : 0x1FFFF  (0x81FFFF8)\n     PCROP2_END   : 0x10000  (0x8180000)\n\n   Write Protection (Bank 2):\n\n     WRP2A_STRT   : 0xFF  (0x81FF000)\n     WRP2A_END    : 0x0  (0x8100000)\n     WRP2B_STRT   : 0xFF  (0x81FF000)\n     WRP2B_END    : 0x0  (0x8100000)\nNote\n\nRecovery documentation created based on original Blues forum post.\n\nIf you are still experiencing difficulties, please contact Blues Support.\n\nCan we improve this page? Send us feedback", "start_char_idx": 4253, "end_char_idx": 4799, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n"}, "__type__": "1"}}, "docstore/ref_doc_info": {"5c0d45f7-bdd3-4170-9492-a0e07f86727f": {"node_ids": ["0d008e71-9ca3-4ea2-8b59-5a6222890f11", "8eeed912-172d-4132-8e7a-971e59de1098", "91f43553-307d-4d09-84e5-496f5585c945", "769c9c43-94ff-4edd-89df-d532324b8765", "efaf7618-6d4e-4e59-b51f-09cdc8e31e29"], "metadata": {"title": "", "category": "Recovering The Stm32L4R5", "url": "https://dev.blues.io/swan/recovering-the-stm32l4r5/"}}}}